<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mortgage Strategy Modeler</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM (Pinned Versions) -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Prop-types (Dependency for some Recharts versions) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>

    <!-- Recharts for the Graph (Pinned Version) -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- Babel for JSX translation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #f8fafc; }
        /* Custom scrollbar for table */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // Safely access Recharts components
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = window.Recharts || {};

        // --- Icons (Inline SVGs to avoid dependencies) ---
        const IconCalculator = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6 text-blue-600">
                <rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/>
            </svg>
        );
        const IconTrendingUp = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
        );
        const IconDollarSign = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5 text-green-600"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        );

        // --- Components ---

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl shadow-sm border border-slate-200 ${className}`}>
                {children}
            </div>
        );

        const InputGroup = ({ label, value, onChange, prefix = "", suffix = "", step = "0.1" }) => (
            <div className="flex flex-col gap-1">
                <label className="text-xs font-semibold text-slate-500 uppercase tracking-wider">{label}</label>
                <div className="relative">
                    {prefix && <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">{prefix}</span>}
                    <input
                        type="number"
                        value={value}
                        onChange={(e) => onChange(parseFloat(e.target.value) || 0)}
                        step={step}
                        className={`w-full p-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all font-medium ${prefix ? 'pl-7' : ''} ${suffix ? 'pr-8' : ''}`}
                    />
                    {suffix && <span className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm">{suffix}</span>}
                </div>
            </div>
        );

        const StatBox = ({ label, value, subtext, color = "text-slate-900", highlight = false }) => (
            <div className={`p-4 rounded-lg ${highlight ? 'bg-blue-50 border border-blue-100' : 'bg-slate-50'}`}>
                <div className="text-sm text-slate-500 mb-1">{label}</div>
                <div className={`text-2xl font-bold ${color}`}>{value}</div>
                {subtext && <div className="text-xs text-slate-400 mt-1">{subtext}</div>}
            </div>
        );

        function MortgageCalculator() {
            // --- State ---
            const [loanAmount, setLoanAmount] = useState(400000);
            const [rate30, setRate30] = useState(6.5);
            const [rate50, setRate50] = useState(7.5);
            const [returnRate, setReturnRate] = useState(8.0);
            const [viewMode, setViewMode] = useState('chart'); 

            // --- Calculations ---
            const results = useMemo(() => {
                const r30 = rate30 / 100 / 12;
                const r50 = rate50 / 100 / 12;
                const rInv = returnRate / 100 / 12;

                const n30 = 30 * 12;
                const n50 = 50 * 12;

                const pmt30 = (loanAmount * r30 * Math.pow(1 + r30, n30)) / (Math.pow(1 + r30, n30) - 1);
                const pmt50 = (loanAmount * r50 * Math.pow(1 + r50, n50)) / (Math.pow(1 + r50, n50) - 1);

                const monthlySavings = pmt30 - pmt50;
                const isSavingsPositive = monthlySavings > 0;

                let balance30 = loanAmount;
                let balance50 = loanAmount;
                let investmentValue = 0;
                let totalInterest30 = 0;
                let totalInterest50 = 0;

                const data = [];
                const yearlyData = [];

                for (let month = 1; month <= 600; month++) {
                    // 30 Year Logic
                    let interest30 = 0;
                    let principal30 = 0;
                    if (month <= n30) {
                        interest30 = balance30 * r30;
                        principal30 = pmt30 - interest30;
                        balance30 -= principal30;
                        totalInterest30 += interest30;
                    } else {
                        balance30 = 0;
                    }

                    // 50 Year Logic
                    let interest50 = balance50 * r50;
                    let principal50 = pmt50 - interest50;
                    balance50 -= principal50;
                    totalInterest50 += interest50;

                    // Investment Logic
                    if (isSavingsPositive) {
                        investmentValue = investmentValue * (1 + rInv);
                        // Invest savings only while 30y loan is active (first 30 years)
                        if (month <= n30) {
                            investmentValue += monthlySavings;
                        }
                    }

                    if (month % 12 === 0 || month === 1) {
                        yearlyData.push({
                            year: Math.ceil(month / 12),
                            balance30: Math.max(0, balance30),
                            balance50: Math.max(0, balance50),
                            investmentValue: investmentValue,
                        });
                    }

                    data.push({
                        month,
                        year: (month/12).toFixed(1),
                        balance30: Math.max(0, balance30),
                        balance50: Math.max(0, balance50),
                        investmentValue,
                        interest30,
                        interest50,
                        principal30,
                        principal50
                    });
                }

                return {
                    pmt30,
                    pmt50,
                    monthlySavings,
                    totalInterest30,
                    totalInterest50,
                    investmentAt30: data[359].investmentValue,
                    investmentAt50: data[599].investmentValue,
                    data,
                    yearlyData
                };
            }, [loanAmount, rate30, rate50, returnRate]);

            // Formatting
            const formatCurrency = (val) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(val);
            const formatCurrencyCents = (val) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val);

            if (!LineChart) {
                return <div className="p-4 text-red-600">Error loading visualization library. Please check your internet connection.</div>;
            }

            return (
                <div className="p-4 max-w-6xl mx-auto bg-slate-50 min-h-screen font-sans text-slate-900">
                
                {/* Header */}
                <div className="mb-6 flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <div>
                    <h1 className="text-2xl font-bold text-slate-800 flex items-center gap-2">
                        <IconCalculator />
                        Mortgage Strategy Modeler
                    </h1>
                    <p className="text-slate-500 text-sm mt-1">Compare 30-year vs. 50-year amortization with investment opportunity cost.</p>
                    </div>
                    
                    <div className="flex bg-white p-1 rounded-lg border border-slate-200">
                    <button 
                        onClick={() => setViewMode('chart')}
                        className={`px-4 py-1.5 rounded-md text-sm font-medium transition-colors ${viewMode === 'chart' ? 'bg-blue-600 text-white' : 'text-slate-600 hover:bg-slate-50'}`}
                    >
                        Visual Model
                    </button>
                    <button 
                        onClick={() => setViewMode('table')}
                        className={`px-4 py-1.5 rounded-md text-sm font-medium transition-colors ${viewMode === 'table' ? 'bg-blue-600 text-white' : 'text-slate-600 hover:bg-slate-50'}`}
                    >
                        Schedule Table
                    </button>
                    </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                    
                    {/* Left Column: Inputs */}
                    <div className="lg:col-span-4 space-y-6">
                    <Card className="p-5">
                        <h2 className="font-bold text-lg mb-4 flex items-center gap-2">
                        <IconDollarSign />
                        Loan Parameters
                        </h2>
                        <div className="space-y-4">
                        <InputGroup label="Loan Amount" value={loanAmount} onChange={setLoanAmount} prefix="$" step="1000" />
                        <div className="grid grid-cols-2 gap-4">
                            <InputGroup label="30-Yr Rate" value={rate30} onChange={setRate30} suffix="%" />
                            <InputGroup label="50-Yr Rate" value={rate50} onChange={setRate50} suffix="%" />
                        </div>
                        <div className="pt-4 border-t border-slate-100">
                            <InputGroup label="Est. Investment Return (S&P 500)" value={returnRate} onChange={setReturnRate} suffix="%" />
                            <p className="text-xs text-slate-400 mt-2">
                            Historic S&P 500 average inflation-adjusted return is ~7-8%.
                            </p>
                        </div>
                        </div>
                    </Card>

                    <Card className="p-5">
                        <h2 className="font-bold text-lg mb-4">Monthly Breakdown</h2>
                        <div className="space-y-4">
                        <div className="flex justify-between items-center p-3 bg-slate-50 rounded-lg border border-slate-100">
                            <span className="text-sm font-medium text-slate-600">30-Year P&I</span>
                            <span className="text-lg font-bold text-slate-800">{formatCurrencyCents(results.pmt30)}</span>
                        </div>
                        <div className="flex justify-between items-center p-3 bg-slate-50 rounded-lg border border-slate-100">
                            <span className="text-sm font-medium text-slate-600">50-Year P&I</span>
                            <span className="text-lg font-bold text-slate-800">{formatCurrencyCents(results.pmt50)}</span>
                        </div>
                        
                        <div className="relative">
                            <div className="absolute inset-0 flex items-center">
                            <div className="w-full border-t border-slate-200"></div>
                            </div>
                            <div className="relative flex justify-center text-xs uppercase">
                            <span className="bg-white px-2 text-slate-500">Difference</span>
                            </div>
                        </div>

                        <div className={`flex flex-col p-4 rounded-lg border-2 ${results.monthlySavings > 0 ? 'bg-green-50 border-green-100' : 'bg-red-50 border-red-100'}`}>
                            <span className="text-sm font-medium text-slate-600 mb-1">Investable Savings</span>
                            <div className="flex items-end gap-2">
                            <span className={`text-2xl font-bold ${results.monthlySavings > 0 ? 'text-green-700' : 'text-red-700'}`}>
                                {results.monthlySavings > 0 ? '+' : ''}{formatCurrencyCents(results.monthlySavings)}
                            </span>
                            <span className="text-xs text-slate-500 mb-1">/ month</span>
                            </div>
                            {results.monthlySavings <= 0 && (
                            <span className="text-xs text-red-600 mt-2">
                                Warning: 50-year rate is too high to yield savings.
                            </span>
                            )}
                        </div>
                        </div>
                    </Card>
                    </div>

                    {/* Right Column: Visualization */}
                    <div className="lg:col-span-8 space-y-6">
                    
                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <StatBox 
                        label="Portfolio at Year 30" 
                        value={formatCurrency(results.investmentAt30)} 
                        subtext="Total accumulated from investing savings"
                        color="text-green-600"
                        highlight={true}
                        />
                        <StatBox 
                        label="30-Yr Total Interest" 
                        value={formatCurrency(results.totalInterest30)} 
                        subtext="Cost of borrowing (30y)"
                        />
                        <StatBox 
                        label="50-Yr Total Interest" 
                        value={formatCurrency(results.totalInterest50)} 
                        subtext="Cost of borrowing (50y)"
                        color="text-red-600"
                        />
                    </div>

                    <Card className="p-6 h-[500px] flex flex-col">
                        {viewMode === 'chart' ? (
                        <>
                            <div className="mb-6">
                            <h3 className="font-bold text-lg text-slate-800">Projection Model (30 vs 50 Years)</h3>
                            <p className="text-sm text-slate-500">
                                Lines show the loan balance decreasing over time vs. the investment portfolio growing.
                            </p>
                            </div>
                            <div className="flex-1 w-full min-h-0">
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={results.yearlyData} margin={{ top: 5, right: 20, left: 10, bottom: 5 }}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                                <XAxis 
                                    dataKey="year" 
                                    label={{ value: 'Years', position: 'insideBottomRight', offset: -5 }} 
                                    tick={{fontSize: 12}}
                                />
                                <YAxis 
                                    tickFormatter={(value) => `$${value / 1000}k`} 
                                    tick={{fontSize: 12}}
                                    width={60}
                                />
                                <Tooltip 
                                    formatter={(value) => formatCurrency(value)}
                                    labelFormatter={(label) => `Year ${label}`}
                                    contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }}
                                />
                                <Legend wrapperStyle={{ paddingTop: '20px' }} />
                                <Line 
                                    type="monotone" 
                                    dataKey="balance30" 
                                    name="30-Year Loan Balance" 
                                    stroke="#3b82f6" 
                                    strokeWidth={2} 
                                    dot={false} 
                                />
                                <Line 
                                    type="monotone" 
                                    dataKey="balance50" 
                                    name="50-Year Loan Balance" 
                                    stroke="#ef4444" 
                                    strokeWidth={2} 
                                    dot={false} 
                                />
                                <Line 
                                    type="monotone" 
                                    dataKey="investmentValue" 
                                    name="Investment Portfolio" 
                                    stroke="#10b981" 
                                    strokeWidth={2} 
                                    dot={false} 
                                />
                                </LineChart>
                            </ResponsiveContainer>
                            </div>
                        </>
                        ) : (
                        <div className="flex flex-col h-full">
                            <div className="flex justify-between items-end mb-4">
                            <div>
                                <h3 className="font-bold text-lg text-slate-800">Amortization Schedule</h3>
                                <p className="text-sm text-slate-500">Showing first 360 months (30 years) for brevity.</p>
                            </div>
                            </div>
                            <div className="flex-1 overflow-auto border border-slate-200 rounded-lg">
                            <table className="w-full text-sm text-left">
                                <thead className="bg-slate-50 text-slate-500 font-medium sticky top-0 z-10">
                                <tr>
                                    <th className="p-3 border-b">Month</th>
                                    <th className="p-3 border-b">30y Balance</th>
                                    <th className="p-3 border-b">50y Balance</th>
                                    <th className="p-3 border-b bg-green-50 text-green-700">Savings Invested</th>
                                    <th className="p-3 border-b">Investment Total</th>
                                </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                {results.data.slice(0, 360).map((row) => (
                                    <tr key={row.month} className="hover:bg-slate-50">
                                    <td className="p-3 text-slate-500">{row.month}</td>
                                    <td className="p-3 font-mono">{formatCurrencyCents(row.balance30)}</td>
                                    <td className="p-3 font-mono">{formatCurrencyCents(row.balance50)}</td>
                                    <td className="p-3 font-mono bg-green-50/50 text-green-700">
                                        {row.month <= 360 ? formatCurrencyCents(results.monthlySavings) : '$0.00'}
                                    </td>
                                    <td className="p-3 font-mono font-bold text-green-600">{formatCurrencyCents(row.investmentValue)}</td>
                                    </tr>
                                ))}
                                </tbody>
                            </table>
                            </div>
                        </div>
                        )}
                    </Card>

                    <Card className="p-5 bg-blue-50 border-blue-100">
                        <h4 className="font-bold text-blue-800 mb-2 flex items-center gap-2">
                        <IconTrendingUp />
                        The Verdict at Year 30
                        </h4>
                        <div className="text-sm text-slate-700 space-y-2">
                        <p>
                            At year 30, the 30-year loan is fully paid off. The 50-year loan still has a balance of <strong>{formatCurrency(results.data[359].balance50)}</strong>.
                        </p>
                        <p>
                            However, if you strictly invested the difference ({formatCurrencyCents(results.monthlySavings)}/mo), your investment portfolio would be worth <strong>{formatCurrency(results.investmentAt30)}</strong>.
                        </p>
                        <p className="font-semibold mt-2">
                            Net Result: {results.investmentAt30 - results.data[359].balance50 > 0 
                            ? <span className="text-green-600">The 50-year strategy is ahead by {formatCurrency(results.investmentAt30 - results.data[359].balance50)}.</span>
                            : <span className="text-red-600">The 30-year strategy is ahead by {formatCurrency(Math.abs(results.investmentAt30 - results.data[359].balance50))}.</span>
                            }
                        </p>
                        </div>
                    </Card>

                    </div>
                </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MortgageCalculator />);
    </script>
</body>
</html>
